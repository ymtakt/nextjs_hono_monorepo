# 本プロジェクト全体に常に適用されるルール

## 1. 共通ルール

- **言語**: 回答は常に日本語で行ってください。
- **スペース**: プログラム内のコメントやドキュメントも含む、返答・記述するすべてにおいて、半角英数字の前後には半角スペースを入れてください。
- **パッケージ管理**: このプロジェクトでは bun を利用してパッケージ管理を行い、package.json のコマンドも `bun run <コマンド名>` で実行します。
- **フォルダ命名**: 名前空間の概念として捉えているため、フォルダ名は単数形で統一します。

## 2. コメント及びドキュメンテーション

- **JSDoc**: export しているすべての public な API には JSDoc を書いてください。
- **口調**: 口調は「だ・である」調で統一します。
- **文章構造**: あえて体言止めにするもの等以外は、日本語として正しい文として成立する文章を書きます。通常のコメントも JSDoc も例外はありません。
- **文末**: すべてのコメント及びドキュメンテーションは、例外なく、必ず「。」で、または、半角英数字で終わる場合は「.」で終わります。
- **JSDoc 作法**: JSDoc については、[Google TypeScript Style Guide](https://google.github.io/styleguide/tsguide.html#comments-documentation) に従います。
- **インラインコメント**: インラインのコメントも充実させますが、ある処理の行に続けて書くタイプのコメントは書かないでください。その処理の前の行に書きます。

## 3. 実装前に必ず確認するルール

### 3.1 アーキテクチャルール

実装を始める前に、関連するアーキテクチャルールを確認してください。

- **ページコンポーネントの実装**: [app-router.md](./app-router.md) のルールに従ってください
- **クライアントページの実装**: [client-page.md](./client-page.md) のルールに従ってください
- **コンポーネントの実装**: [component.md](./component.md) のルールに従ってください
- **Server Action の実装**: [server-action.md](./server-action.md) のルールに従ってください
- **ドメインロジックの実装**: [domain-logic.md](./domain-logic.md) のルールに従ってください
- **API サービスの実装**: [core-service.md](./core-service.md) のルールに従ってください

### 3.2 エラーハンドリングルール

- **ドメインロジック層**: Result 型でエラーを返却し、HTTP エラーの詳細を隠蔽します。
- **Server Action**: エラーメッセージを設定して ActionState で返却します。
- **クライアント側**: toast でエラーメッセージを表示し、一貫した UI 表現を提供します。

### 3.3 バリデーションルール

- **スキーマ定義**: zod を使用して型安全なバリデーションを実装します。
- **エラーメッセージ**: エラーメッセージは一元管理し、一貫した形式で表示します。
- **実行タイミング**: フォーム送信時とインタラクション時の適切なタイミングでバリデーションを実行します。

### 3.4 テストルール

- **テストの分類**: core、domain、util、action の各レイヤーに応じたテストを実装します。
- **テストの観点**: 基本機能、バリデーション、セキュリティ、エッジケース、データ整合性の観点でテストを実装します。
- **テストファイル構成**: ミラー構造でテストファイルを配置します。

### 3.5 実装チェックリスト

- アーキテクチャの責務分離が適切か

  - ページコンポーネントは SSR のみを担当しているか
  - クライアントページは画面に 1:1 で作成されているか
  - 機能なし/機能ありコンポーネントの使い分けは適切か
  - ドメインロジックは React の依存を持っていないか

- エラーハンドリングが適切か

  - Result 型でエラーを返却しているか
  - エラーメッセージは一元管理されているか
  - UI での表示が適切か

- バリデーションが適切か

  - zod スキーマが定義されているか
  - エラーメッセージは適切か
  - バリデーションのタイミングは適切か

- テストが適切か
  - 必要なテストケースが網羅されているか
  - テストの粒度は適切か
  - テストの配置は適切か

実装を始める前に、上記のルールを確認し、不明点があれば質問してください。
